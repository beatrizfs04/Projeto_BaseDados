<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>DIUBI | Create</title>
        <link rel="stylesheet" href="styles">
    </head>
    <body>
        <h1>Criar Dados | UBI</h1>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="ver_dados">Ver Dados</a></li>
                <li><a href="criar_dados" class="selected">Criar Dados</a></li>
                <li><a href="mudar_dados">Mudar Dados</a></li>
                <li><a href="eliminar_dados">Eliminar Dados</a></li>
                <li><a href="ver_creditos">Ver Créditos</a></li>
            </ul>
        </nav>
        <main>
            <h2>Criar Dados</h2>
            <hr><br>
            <div class="escolha">
                <button id="projeto" type="button">Projeto</button>
                <button id="serviço" type="button">Prestação de Serviço</button>
            </div>
            <!--Projeto-->
            <div class="escolhaProjeto">
                <h3>Preencha os seguintes dados para criar um Projeto.</h3>
                <form>
                    <h2>Projeto</h2>
                    <!-- 
                        DUVIDA: 
                        Eu tirei o campo: Identificador do Projeto: (IdPrestacaoServico).
                        É preciso pedir o IdProjeto? O Id não é gerado automáticamente?
                    -->
                    
                    Nome do Projeto: <!--(NomeServiço)--> 
                    <input type="text"><br>
                    
                    Descrição: <!--(Descricao)--> 
                    <textarea></textarea><br>
                    
                    Estado atual: <!--(IdEstado)--> 
                    <select name="Estado" id="estado">
                        <!-- 
                            DUVIDA:
                            Tem que se guardar isto na BD Estado? 
                            Ou é para ir buscar estes valores à BD Estado? 
                        -->
                        <option value="aprovado">aprovado</option>
                        <option value="cancelado">cancelado</option>
                        <option value="concluído">concluído</option>
                        <option value="em curso">em curso</option>
                        <option value="encerrado">encerrado</option>
                        <option value="renovado">renovado</option>
                        <option value="em submissão">em submissão</option>
                    </select><br> 

                    Identificador Responsável: <!--(IdInterno)--> 
                    <input type="text"><br>
                    
                    DataInicio: <!--(IdData)--> 
                    <input type="date"><br>

                    DataFim: <!--(IdData)--> 
                    <input type="date"><br> 

                    Área Científica: <!--(IdArea)--> 
                    <select name="AreaCientifica" id="area">
                        <option value=""></option> 
                        <!-- Buscar valores à base de dados -->
                    </select><br>

                    Domínio Científico: <!--(IdDominio)--> 
                    <select name="DominioCientifica" id="dominio">
                        <option value=""></option> 
                        <!-- Buscar valores à base de dados -->
                    </select><br>

                    Investigador do Responsável: <!--(IdMembro)--> 
                    <select name="Investigador" id="investigador">
                        <option value=""></option> 
                        <!-- Buscar valores à base de dados -->
                    </select><br>

                    Palavras Chaves Associadas: <!--(Tabela AssociarPalavraChave)--> 
                    <select name="PalavrasChaves" id="chaves">
                        <option value=""></option> 
                        <!-- Buscar valores à base de dados -->
                    </select><br>

                    <br>
                    <h2>Equipas</h2>

                    Quantos membros terá o Projeto:
                    <input type="text" id="numMembros" oninput="adicionarCampos()" onkeypress="if(this.value.length>=1) return false;"><br>
                    
                    Identifique abaixo os Membros:
                    <div id="membrosContainer"><br>
                        <small> « Tem que prencher o campo acima primeiro » </small>
                        <!-- Campos de seleção serão adicionados aqui pelo script: adicionarCampos() -->
                    </div>
                    
                    <br>
                    <h2>Financiamento</h2>

                    <!-- 
                        DUVIDA: 
                        Eu tirei o campo: Identificador do Financiamento: (IdFinanciamento).
                        É preciso pedir o IdFinanciamento? O Id não é gerado automáticamente?
                    -->

                    Financiador: <!--(IdFinanciador)-->
                    <select name="Financiador" id="financiador">
                        <option value=""></option> 
                        <!-- Buscar valores á base de dados -->
                    </select><br>

                    Tipo Financiamento: <!--(TipoFinanciamento)-->
                    <select name="TipoFinanciamento" id="tipofinanciamento">
                        <option value="Competitivo">Competitivo</option>
                        <option value="naoCompetitivo">Não Competitivo</option>
                    </select><br>
                    
                    Origem Financiamento: <!--(OrigemFinanciamento)-->
                    <select name="OrigemFinanciamento" id="origemfinanciamento">
                        <option value="externo">Externo</option>
                        <option value="interno">Interno</option>
                    </select><br>

                    Valor Total:<!--(Valor)-->
                    <input type="number"><br>

                    Valor Atribuído a Equipa: <!--(CustoEquipa)-->
                    <input type="number"><br>

                    Valor Atribuído ao Projeto: <!--(CustoProjeto)-->
                    <input type="number"><br>
                </form>
            </div>

            <!--Prestação de Serviço-->
            <div class="escolhaServiço">
                <h3>Preencha os seguintes dados para criar uma Prestação de Serviço.</h3>

                <form>
                    <h2>Pretação de Serviço</h2>
                    <!-- 
                        DUVIDA: 
                        Eu tirei o campo: Identificador da Prestação de Serviço: (IdPrestacaoServico).
                        É preciso pedir o IdPrestacaoServico? O Id não é gerado automáticamente?
                    -->
                    
                    Nome da Prestação de Serviço: <!--(NomeServiço)--> 
                    <input type="text"><br>
                    
                    Descrição: <!--(Descricao)--> 
                    <textarea></textarea><br>
                    
                    Estado atual: <!--(IdEstado)--> 
                    <select name="Estado" id="estado"> 
                        <!-- 
                            DUVIDA:
                            Tem que se guardar isto na BD Estado? 
                            Ou é para ir buscar estes valores à BD Estado? 
                        -->
                        <option value="aprovado">aprovado</option>
                        <option value="cancelado">cancelado</option>
                        <option value="concluído">concluído</option>
                        <option value="em curso">em curso</option>
                        <option value="encerrado">encerrado</option>
                        <option value="renovado">renovado</option>
                        <option value="em submissão">em submissão</option>
                    </select><br> 

                    Identificador do Interno Responsável: <!--(IdInterno)--> 
                    <select name="Responsável" id="responsável">
                        <option value=""></option>
                        <!-- Buscar valores à base de dados -->
                    </select>
                    
                    DataInicio: <!--(IdData)--> 
                    <input type="date"><br>

                    Área Científica: <!--(IdArea)--> 
                    <!-- Qual era mesmo a diferença entre o dominio cientifico e a area? -->
                    <select name="AreaCientifica" id="area">
                        <option value=""></option>
                        <!-- Buscar valores à base de dados -->
                    </select><br>

                    Domínio Científico: <!--(IdDominio)--> 
                    <!-- Qual era mesmo a diferença entre o dominio cientifico e a area? -->
                    <select name="DominioCientifico" id="dominio">
                        <option value=""></option>
                        <!-- Buscar valores à base de dados -->
                    </select><br>

                    Investigador Responsável: <!--(IdMembro)--> 
                    <select name="Investigador" id="investigador">
                        <option value=""></option> 
                        <!-- Buscar valores à base de dados -->
                    </select><br>

                    Palavras Chaves Associadas: <!--(Tabela AssociarPalavraChave)--> 
                    <select name="PalavrasChaves" id="chaves">
                        <option value=""></option> 
                        <!-- Buscar valores à base de dados -->
                    </select>

                    <br>
                    <h2>Financiamento</h2>

                    <!-- 
                        DUVIDA: 
                        Eu tirei o campo: Identificador do Financiamento: (IdFinanciamento).
                        É preciso pedir o IdFinanciamento? O Id não é gerado automáticamente?
                    -->

                    Financiador: <!--(IdFinanciador)-->
                    <select name="Financiador" id="financiador">
                        <option value=""></option> 
                        <!-- Buscar valores á base de dados -->
                    </select><br>

                    Tipo Financiamento: <!--(TipoFinanciamento)-->
                    <select name="TipoFinanciamento" id="tipofinanciamento">
                        <option value="Competitivo">Competitivo</option>
                        <option value="naoCompetitivo">Não Competitivo</option>
                    </select><br>
                    
                    Origem Financiamento: <!--(OrigemFinanciamento)-->
                    <select name="OrigemFinanciamento" id="origemfinanciamento">
                        <option value="externo">Externo</option>
                        <option value="interno">Interno</option>
                    </select><br>

                    Valor:<!--(Valor)-->
                    <input type="number">
                </form>
            </div>
        </main>

        <script>

            // Procurar Membros assuciados a projeto <- Está mal tem que se procurar membros na tabela Membros só.
            async function fetchProjects() {
                try {
                  const response = await fetch('/api/getInvestigadores');
                  if (!response.ok) {
                    throw new Error('Network response was not ok');
                  }
                  const projects = await response.json();
                  const dropdown = document.getElementById('investigador');
                  projects.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project.IdPessoa;
                    option.text = `${project.IdPessoa} - ${project.PrimeiroNome} ${project.UltimoNome}`;
                    dropdown.add(option);
                  });
                } catch (error) {
                  console.error('Failed to fetch projects:', error);
                }
            }
            
            window.onload = fetchProjects;

            // adicionar campos
            function adicionarCampos() {
                const numeroDeMembros = document.getElementById('numMembros').value;
                const container = document.getElementById('membrosContainer');
                container.innerHTML = '';
                
                for (let i = 0; i < numeroDeMembros; i++) {
                    const select = document.createElement('select');
                    select.name = 'Membro';
                    select.id = `membro${i}`;

                    // Precisamos que procura membros na tabela Membros. 
                    // É preciso tbm que guarde os membros na tabela Equipa.
                    const option1 = document.createElement('option');
                    option1.value = '';
                    option1.textContent = '';
                    
                    const option2 = document.createElement('option');
                    option2.value = '1';
                    option2.textContent = 'Membro 1';
                    
                    const option3 = document.createElement('option');
                    option3.value = '2';
                    option3.textContent = 'Membro 2';
                    
                    select.appendChild(option1);
                    select.appendChild(option2);
                    select.appendChild(option3);
                    
                    container.appendChild(select);
                    container.appendChild(document.createElement('br'));
                }
            }
        </script>
        <script src="mudar_divs"></script>
    </body>
    <script src="index.js"></script>
</html>